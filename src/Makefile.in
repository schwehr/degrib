SHELL = @SHELL@

top_srcdir = @top_srcdir@
abs_top_builddir = @abs_top_builddir@
package = @PACKAGE_NAME@-@PACKAGE_VERSION@

CC = @CC@
CFLAGS = @CFLAGS@
ARFLAGS = @ARFLAGS@
EXEEXT = @EXEEXT@

LIB_DEP1 = ./libaat/libaat.a

LIB_DEPENDS = $(LIB_DEP1) \
              ./mdl_g2c/libmdl_g2c.a \
              ./emapf-c/libemapf.a

PRJ_NAME = @PACKAGE_NAME@

all: xyz2shp/xyz2shp $(PRJ_NAME)/$(PRJ_NAME) install

xyz2shp/xyz2shp: $(LIB_DEP1)
	@echo "-----------------------------"
	@echo "Attempting to compile xyz2shp..."
	(cd xyz2shp && make)
	@echo "Finished with xyz2shp"
	@echo "-----------------------------"
	@echo ""

$(PRJ_NAME)/$(PRJ_NAME): $(LIB_DEPENDS)
	@echo "-----------------------------"
	@echo "Attempting to compile $(PRJ_NAME)..."
	(cd $(PRJ_NAME) && make)
	@echo "Finished with $(PRJ_NAME)"
	@echo "-----------------------------"
	@echo ""

#####
# LIBRARIES
#####

./libaat/libaat.a: ./libaat/Makefile
	@echo "-----------------------------"
	@echo "Attempting to compile libaat..."
	(cd libaat && make)
	@echo "Finished with libaat..."
	@echo "-----------------------------"
	@echo ""

./mdl_g2c/libmdl_g2c.a: ./mdl_g2c/Makefile
	@echo "-----------------------------"
	@echo "Attempting to compile mdl_g2c..."
	(cd mdl_g2c && make)
	@echo "Finished with mdl_g2c..."
	@echo "-----------------------------"
	@echo ""

./emapf-c/libemapf.a: ./emapf-c/Makefile
	@echo "-----------------------------"
	@echo "Attempting to compile emapf-c..."
	(cd emapf-c &&	make)
	@echo "Finished with emapf-c..."
	@echo "-----------------------------"
	@echo ""

#####
# Configurables
#####
${top_srcdir}/Makefile: ${top_srcdir}/configure
	@echo "-----------------------------"
	@echo "Attempting to configure memwatch..."
	(cd ${top_srcdir}/ && ./configure)
	@echo "-----------------------------"
	@echo ""

./emapf-c/Makefile: ./emapf-c/configure
	@echo "-----------------------------"
	@echo "Attempting to configure emapf-c..."
	(cd ./emapf-c && ./configure CC="$(CC)" CFLAGS="$(CFLAGS)" ARFLAGS=$(ARFLAGS))
	@echo "Finished with emapf-c..."
	@echo "-----------------------------"
	@echo ""

#####
# Regular targets
#####
install:
	@echo "-----------------------------"
	@echo "Attempting to install xyz2shp..."
	(cd xyz2shp && make install)
	@echo "Finished with install of xyz2shp"
	@echo "Attempting to install $(PRJ_NAME)..."
	(cd $(PRJ_NAME) && make install)
	@echo "Finished with install of $(PRJ_NAME)"
	@echo "-----------------------------"

clean: ./emapf-c/Makefile
	- (cd ./xyz2shp && make clean)
	(cd ./libaat && make clean)
	(cd ./mdl_g2c && make clean)
	- (cd ./emapf-c && make clean)
	(cd ./dwmllib && make clean)
	- (cd ./degrib && make clean)
	rm -r -f *.bak

# Note: This depends on the "Configurable's"
distclean: ./emapf-c/Makefile
	(cd ./libaat && make distclean)
	(cd ./mdl_g2c && make distclean)
	- (cd ./emapf-c && make distclean)
	(cd ./dwmllib && make clean)
	- (cd ./degrib && make distclean)
	rm -r -f *.bak config.status config.log Makefile autom4te.cache

